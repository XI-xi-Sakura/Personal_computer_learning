# 数据链路层
用于两个设备（同一种数据链路节点）之间进行传递。



## 认识以太网
- “以太网” 不是一种具体的网络，而是一种技术标准；既包含了数据链路层的内容，也包含了一些物理层的内容。例如：规定了网络拓扑结构，访问控制方式，传输速率等；
- 例如以太网中的网线必须使用双绞线；传输速率有 10M，100M，1000M 等；
- 以太网是当前应用最广泛的局域网技术；和以太网并列的还有令牌环网，无线 LAN 等；

## 以太网帧格式
以太网的帧格式如下所示：
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/ff11d6fadf604fafa8d790b3e736d820.png)


- 源地址和目的地址是指网卡的硬件地址（也叫 MAC 地址），长度是 48 位，是在网卡出厂时固化的；
- 帧协议类型字段有三种值，分别对应 `IP`、`ARP`、`RARP`；
- 帧末尾是 CRC 校验码。

## 认识MAC地址
- MAC 地址用来识别数据链路层中相连的节点；
- 长度为 48 位，及 6 个字节。一般用 16 进制数字加上冒号的形式来表示(例如: 08:00:27:03:fb:19)；
- 在网卡出厂时就确定了，不能修改。mac 地址通常是唯一的（虚拟机中的 mac 地址不是真实的 mac 地址，可能会冲突；也有些网卡支持用户配置 mac 地址）。



## 认识MTU
MTU 相当于发快递时对包裹尺寸的限制。这个限制是不同的数据链路对应的物理层产生的限制。
- 以太网帧中的数据长度规定最小 46 字节，最大 1500 字节，ARP 数据包的长度不够 46 字节，要在后面补填充位；
- 最大值 1500 称为以太网的最大传输单元(MTU)，不同的网络类型有不同的 MTU；
- 如果一个数据包从以太网路由到拨号链路上，数据包长度大于拨号链路的 MTU 了，则需要对数据包进行分片(fragmentation)；
- 不同的数据链路层标准的 MTU 是不同的；


### MTU对IP协议的影响
由于数据链路层 MTU 的限制，对于较大的 IP 数据包要进行分包。
- 将较大的 IP 包分成多个小包，并给每个小包打上标签；
- 每个小包 IP 协议头的 16 位标识(id) 都是相同的；
- 每个小包的 IP 协议头的 3 位标志字段中，第 2 位置为 0，表示允许分片，第 3 位来表示结束标记(当前是否是最后一个小包，是的话置为 1，否则置为 0)；
- 到达对端时再将这些小包，会按顺序重组，拼装到一起返回给传输层；
- 一旦这些小包中任意一个小包丢失，接收端的重组就会失败。但是 IP 层不会负责重新传输数据；
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/773ad9e806524b9bbe3cf8529c598a23.png)

### MTU对UDP协议的影响
让我们回顾一下 UDP 协议：
- 在网络层 UDP 多携带的数据超过 1472(1500 - 20(IP 首部) - 8(UDP 首部))，那么就会产生多个 IP 数据报。
- 这多个 IP 数据报有任意一个丢失，都会引起接收端网络层重组失败。那么这就意味着，如果 UDP 数据报在网络层被分片，整个数据被丢失的概率就大大增加了。

### MTU对于TCP协议的影响
让我们再回顾一下 TCP 协议：
- TCP 的一个数据报也不能无限大，还是受制于 MTU。TCP 的单个数据报的最大消息长度，称为 `MSS`(Max Segment Size)；
- TCP 在建立连接的过程中，通信双方会进行 MSS 协商；
- 最理想的情况下，MSS 的值正好是在 IP 不会被分片处理的最大长度(这个长度就是受制于数据链路层的 MTU)；
- 双方在发送 SYN 的时候会在 TCP 头部写入自己能支持的 MSS 值；
- 然后双方得知对方的 MSS 值之后，选择较小的作为最终 MSS；
- MSS 的值就在 TCP 首部的 40 字节变长选项中 (kind=2)；

## MSS和MTU的关系
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/693edb88f65741d386e9bfc9f3a8944c.png)


## 查看硬件地址和MTU
使用 `ifconfig` 命令，即可查看 ip 地址，mac 地址，和 MTU；
## 局域网细节
- 为了避免局域网中数据碰撞问题，要保证任何时刻只有一台主机在使用局域网资源
- 如果碰撞了，涉及到碰撞主机怎么办？
	- 碰撞检测，碰撞避免（对临界资源的保护）
- 整个局域网，被称为碰撞域  

