--source include/have_router.inc

--let $extra_mrs_router_id=1
--source ../include/predefined_setup/configure_router_mrs_root.inc
--source ../include/schema/basic_schema.sql


--echo
--echo
--echo ## I. Disable autogenerated links field in db_object
--echo #
--echo # 1. in FEED response when the output is not limited
--echo # 2. in FEED response when the output is limited
--echo # 3. in OBJECT response when selecting object by ID
--echo #
--echo ## II. Disable autogenerated links field in db_schema
--echo #
--echo # 1. in FEED response when the output is not limited
--echo # 2. in FEED response when the output is limited
--echo # 3. in OBJECT response when selecting object by ID
--echo #
--echo ## III. Disable autogenerated links field in service
--echo #
--echo # 1. in FEED response when the output is not limited
--echo # 2. in FEED response when the output is limited
--echo # 3. in OBJECT response when selecting object by ID
--echo #
--echo #

--source ../include/mrs/start_object_definition.inc

# The test uses HOST to have only paths in HREF fields.
--let $mrs_add_service_path="/svc"
--let $mrs_add_host_name=""
--source ../include/mrs/service/add.inc

--let $mrs_add_schema=basic_schema
--let $mrs_add_schema_path=/basic
--source ../include/mrs/db_schema/add.inc

--let $mrs_add_db_object=table2
--let $mrs_add_db_object_path=/t_disabled
--let $mrs_add_db_object_options='{"result":{"includeLinks":false}}'
--source ../include/mrs/db_object/add.inc


--let $mrs_add_schema=basic_schema
--let $mrs_add_schema_path=/basic_disabled
--let $mrs_add_schema_options='{"result":{"includeLinks":false}}'
--source ../include/mrs/db_schema/add.inc

--let $mrs_add_db_object=table2
--let $mrs_add_db_object_path=/t
--source ../include/mrs/db_object/add.inc


--let $mrs_add_service_path="/svc_disabled"
--let $mrs_add_host_name=""
--let $mrs_add_service_options='{"result":{"includeLinks":false}}'
--source ../include/mrs/service/add.inc

--let $mrs_add_schema=basic_schema
--let $mrs_add_schema_path=/basic
--source ../include/mrs/db_schema/add.inc

--let $mrs_add_db_object=table2
--let $mrs_add_db_object_path=/t
--source ../include/mrs/db_object/add.inc

--source ../include/mrs/end_object_definition.inc

#ALTER TABLE basic_schema.table2 ADD COLUMN links 
--let $mrs_host_and_port=127.0.0.1:$HTTP_SERVER_PORT
--let MRS_CLIENT_ARGS=$MRS_CLIENT --url https://$mrs_host_and_port

let $MRS_CLIENT_ITEMS=$MRS_CLIENT_ARGS
     --exclude-json-pointer /limit,/offset,/hasMore,/count --json-schema-file $SCHEMA_DIR/items_without_links.sch;
     
let $MRS_CLIENT_OBJECT=$MRS_CLIENT_ARGS --json-schema-file $SCHEMA_DIR/object_without_links.sch;
--exec $MRS_CLIENT_ARGS --path /svc/basic/t_disabled/1 --wait-until-status 60 --display none

--echo
--echo #
--echo # I.1
--exec $MRS_CLIENT_ITEMS --path /svc/basic/t_disabled

--echo
--echo #
--echo # I.2
--let $mrs_client_exe_args=$MRS_CLIENT_ITEMS
--let $mrs_client_arg_path='/svc/basic/t_disabled?offset=1&limit=2'
--source ../include/mrs/mrs_client.inc

--let $mrs_client_exe_args=$MRS_CLIENT_ITEMS
--let $mrs_client_arg_path='/svc/basic/t_disabled?offset=3&limit=2'
--source ../include/mrs/mrs_client.inc

--echo
--echo #
--echo # I.3
--exec $MRS_CLIENT_OBJECT --path /svc/basic/t_disabled/1
--exec $MRS_CLIENT_OBJECT --path /svc/basic/t_disabled/2

--echo
--echo #
--echo # II.1
--exec $MRS_CLIENT_ITEMS --path /svc/basic_disabled/t

--echo
--echo #
--echo # II.2
--let $mrs_client_exe_args=$MRS_CLIENT_ITEMS
--let $mrs_client_arg_path='/svc/basic_disabled/t?offset=1&limit=2'
--source ../include/mrs/mrs_client.inc

--let $mrs_client_exe_args=$MRS_CLIENT_ITEMS
--let $mrs_client_arg_path='/svc/basic_disabled/t?offset=3&limit=2'
--source ../include/mrs/mrs_client.inc

--echo
--echo #
--echo # II.3
--exec $MRS_CLIENT_OBJECT --path /svc/basic_disabled/t/1
--exec $MRS_CLIENT_OBJECT --path /svc/basic_disabled/t/2

--echo
--echo #
--echo # III.1
--exec $MRS_CLIENT_ITEMS --path /svc_disabled/basic/t

--echo
--echo #
--echo # III.2
--let $mrs_client_exe_args=$MRS_CLIENT_ITEMS
--let $mrs_client_arg_path='/svc_disabled/basic/t?offset=1&limit=2'
--source ../include/mrs/mrs_client.inc

--let $mrs_client_exe_args=$MRS_CLIENT_ITEMS
--let $mrs_client_arg_path='/svc_disabled/basic/t?offset=3&limit=2'
--source ../include/mrs/mrs_client.inc

--echo
--echo #
--echo # III.3
--exec $MRS_CLIENT_OBJECT --path /svc_disabled/basic/t/1
--exec $MRS_CLIENT_OBJECT --path /svc_disabled/basic/t/2


# Cleanup
--let $cleanup_arg_mrs_existing_service=/svc/basic/t_disabled
--source ../include/mrs/cleanup.inc
